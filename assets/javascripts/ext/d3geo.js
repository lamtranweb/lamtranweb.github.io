define(["require","d3"],function(e){"use strict";var t=e("d3");return function(e){function n(e,t){return function(n){return n&&n.type in e?e[n.type](n):t}}function r(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+ -2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function i(e,t){e.type in s&&s[e.type](e,t)}function o(e,t){i(e.geometry,t)}function u(e,t){for(var n=e.features,r=0,s=n.length;r<s;r++)i(n[r].geometry,t)}function a(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)t.apply(null,n[r])}function f(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)for(var s=n[r],o=0,u=s.length;o<u;o++)t.apply(null,s[o])}function l(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)for(var s=n[r][0],o=0,u=s.length;o<u;o++)t.apply(null,s[o])}function c(e,t){t.apply(null,e.coordinates)}function h(e,t){for(var n=e.coordinates[0],r=0,i=n.length;r<i;r++)t.apply(null,n[r])}function p(e){return e.source}function d(e){return e.target}function v(e,n){function g(e){var n=Math.sin(v-(e*=v))/m,r=Math.sin(e)/m,o=n*u*i+r*p*l,f=n*u*s+r*p*c,h=n*a+r*d;return[Math.atan2(f,o)/t,Math.atan2(h,Math.sqrt(o*o+f*f))/t]}var r=e[0]*t,i=Math.cos(r),s=Math.sin(r),o=e[1]*t,u=Math.cos(o),a=Math.sin(o),f=n[0]*t,l=Math.cos(f),c=Math.sin(f),h=n[1]*t,p=Math.cos(h),d=Math.sin(h),v=g.d=Math.acos(Math.max(-1,Math.min(1,a*d+u*p*Math.cos(f-r)))),m=Math.sin(v);return g}var t=Math.PI/180;e.geo.azimuthal=function(){function f(n){var o=n[0]*t-s,f=n[1]*t,l=Math.cos(o),c=Math.sin(o),h=Math.cos(f),p=Math.sin(f),d=e!=="orthographic"?a*p+u*h*l:null,v,m=e==="stereographic"?1/(1+d):e==="gnomonic"?1/d:e==="equidistant"?(v=Math.acos(d),v?v/Math.sin(v):0):e==="equalarea"?Math.sqrt(2/(1+d)):1,g=m*h*c,y=m*(a*h*l-u*p);return[r*g+i[0],r*y+i[1]]}var e="orthographic",n,r=200,i=[480,250],s,o,u,a;return f.invert=function(n){var o=(n[0]-i[0])/r,f=(n[1]-i[1])/r,l=Math.sqrt(o*o+f*f),c=e==="stereographic"?2*Math.atan(l):e==="gnomonic"?Math.atan(l):e==="equidistant"?l:e==="equalarea"?2*Math.asin(.5*l):Math.asin(l),h=Math.sin(c),p=Math.cos(c);return[(s+Math.atan2(o*h,l*u*p+f*a*h))/t,Math.asin(p*a-(l?f*h*u/l:0))/t]},f.mode=function(t){return arguments.length?(e=t+"",f):e},f.origin=function(e){return arguments.length?(n=e,s=n[0]*t,o=n[1]*t,u=Math.cos(o),a=Math.sin(o),f):n},f.scale=function(e){return arguments.length?(r=+e,f):r},f.translate=function(e){return arguments.length?(i=[+e[0],+e[1]],f):i},f.origin([0,0])},e.geo.albers=function(){function f(e){var n=o*(t*e[0]-s),f=Math.sqrt(u-2*o*Math.sin(t*e[1]))/o;return[r*f*Math.sin(n)+i[0],r*(f*Math.cos(n)-a)+i[1]]}function l(){var r=t*n[0],i=t*n[1],l=t*e[1],c=Math.sin(r),h=Math.cos(r);return s=t*e[0],o=.5*(c+Math.sin(i)),u=h*h+2*o*c,a=Math.sqrt(u-2*o*Math.sin(l))/o,f}var e=[-98,38],n=[29.5,45.5],r=1e3,i=[480,250],s,o,u,a;return f.invert=function(e){var n=(e[0]-i[0])/r,f=(e[1]-i[1])/r,l=a+f,c=Math.atan2(n,l),h=Math.sqrt(n*n+l*l);return[(s+c/o)/t,Math.asin((u-h*h*o*o)/(2*o))/t]},f.origin=function(t){return arguments.length?(e=[+t[0],+t[1]],l()):e},f.parallels=function(e){return arguments.length?(n=[+e[0],+e[1]],l()):n},f.scale=function(e){return arguments.length?(r=+e,f):r},f.translate=function(e){return arguments.length?(i=[+e[0],+e[1]],f):i},l()},e.geo.albersUsa=function(){function s(e){var s=e[0],o=e[1];return(o>50?n:s<-140?r:o<21?i:t)(e)}var t=e.geo.albers(),n=e.geo.albers().origin([-160,60]).parallels([55,65]),r=e.geo.albers().origin([-160,20]).parallels([8,18]),i=e.geo.albers().origin([-60,10]).parallels([8,18]);return s.scale=function(e){return arguments.length?(t.scale(e),n.scale(e*.6),r.scale(e),i.scale(e*1.5),s.translate(t.translate())):t.scale()},s.translate=function(e){if(!arguments.length)return t.translate();var o=t.scale()/1e3,u=e[0],a=e[1];return t.translate(e),n.translate([u-400*o,a+170*o]),r.translate([u-190*o,a+200*o]),i.translate([u+580*o,a+430*o]),s},s.scale(t.scale())},e.geo.bonne=function(){function u(u){var a=u[0]*t-r,f=u[1]*t-i;if(s){var l=o+s-f,c=a*Math.cos(f)/l;a=l*Math.sin(c),f=l*Math.cos(c)-o}else a*=Math.cos(f),f*=-1;return[e*a+n[0],e*f+n[1]]}var e=200,n=[480,250],r,i,s,o;return u.invert=function(i){var u=(i[0]-n[0])/e,a=(i[1]-n[1])/e;if(s){var f=o+a,l=Math.sqrt(u*u+f*f);a=o+s-l,u=r+l*Math.atan2(u,f)/Math.cos(a)}else a*=-1,u/=Math.cos(a);return[u/t,a/t]},u.parallel=function(e){return arguments.length?(o=1/Math.tan(s=e*t),u):s/t},u.origin=function(e){return arguments.length?(r=e[0]*t,i=e[1]*t,u):[r/t,i/t]},u.scale=function(t){return arguments.length?(e=+t,u):e},u.translate=function(e){return arguments.length?(n=[+e[0],+e[1]],u):n},u.origin([0,0]).parallel(45)},e.geo.equirectangular=function(){function n(n){var r=n[0]/360,i=-n[1]/360;return[e*r+t[0],e*i+t[1]]}var e=500,t=[480,250];return n.invert=function(n){var r=(n[0]-t[0])/e,i=(n[1]-t[1])/e;return[360*r,-360*i]},n.scale=function(t){return arguments.length?(e=+t,n):e},n.translate=function(e){return arguments.length?(t=[+e[0],+e[1]],n):t},n},e.geo.mercator=function(){function r(r){var i=r[0]/360,s=-(Math.log(Math.tan(Math.PI/4+r[1]*t/2))/t)/360;return[e*i+n[0],e*Math.max(-0.5,Math.min(.5,s))+n[1]]}var e=500,n=[480,250];return r.invert=function(r){var i=(r[0]-n[0])/e,s=(r[1]-n[1])/e;return[360*i,2*Math.atan(Math.exp(-360*s*t))/t-90]},r.scale=function(t){return arguments.length?(e=+t,r):e},r.translate=function(e){return arguments.length?(n=[+e[0],+e[1]],r):n},r},e.geo.path=function(){function o(e,n){return typeof t=="function"&&(i=r(t.apply(this,arguments))),a(e)||null}function u(e){return s(e).join(",")}function l(e){var t=p(e[0]),n=0,r=e.length;while(++n<r)t-=p(e[n]);return t}function c(t){var n=e.geom.polygon(t[0].map(s)),r=n.area(),i=n.centroid(r<0?(r*=-1,1):-1),o=i[0],u=i[1],a=r,f=0,l=t.length;while(++f<l)n=e.geom.polygon(t[f].map(s)),r=n.area(),i=n.centroid(r<0?(r*=-1,1):-1),o-=i[0],u-=i[1],a-=r;return[o,u,6*a]}function p(t){return Math.abs(e.geom.polygon(t.map(s)).area())}var t=4.5,i=r(t),s=e.geo.albersUsa(),a=n({FeatureCollection:function(e){var t=[],n=e.features,r=-1,i=n.length;while(++r<i)t.push(a(n[r].geometry));return t.join("")},Feature:function(e){return a(e.geometry)},Point:function(e){return"M"+u(e.coordinates)+i},MultiPoint:function(e){var t=[],n=e.coordinates,r=-1,s=n.length;while(++r<s)t.push("M",u(n[r]),i);return t.join("")},LineString:function(e){var t=["M"],n=e.coordinates,r=-1,i=n.length;while(++r<i)t.push(u(n[r]),"L");return t.pop(),t.join("")},MultiLineString:function(e){var t=[],n=e.coordinates,r=-1,i=n.length,s,o,a;while(++r<i){s=n[r],o=-1,a=s.length,t.push("M");while(++o<a)t.push(u(s[o]),"L");t.pop()}return t.join("")},Polygon:function(e){var t=[],n=e.coordinates,r=-1,i=n.length,s,o,a;while(++r<i){s=n[r],o=-1;if((a=s.length-1)>0){t.push("M");while(++o<a)t.push(u(s[o]),"L");t[t.length-1]="Z"}}return t.join("")},MultiPolygon:function(e){var t=[],n=e.coordinates,r=-1,i=n.length,s,o,a,f,l,c;while(++r<i){s=n[r],o=-1,a=s.length;while(++o<a){f=s[o],l=-1;if((c=f.length-1)>0){t.push("M");while(++l<c)t.push(u(f[l]),"L");t[t.length-1]="Z"}}}return t.join("")},GeometryCollection:function(e){var t=[],n=e.geometries,r=-1,i=n.length;while(++r<i)t.push(a(n[r]));return t.join("")}}),f=o.area=n({FeatureCollection:function(e){var t=0,n=e.features,r=-1,i=n.length;while(++r<i)t+=f(n[r]);return t},Feature:function(e){return f(e.geometry)},Polygon:function(e){return l(e.coordinates)},MultiPolygon:function(e){var t=0,n=e.coordinates,r=-1,i=n.length;while(++r<i)t+=l(n[r]);return t},GeometryCollection:function(e){var t=0,n=e.geometries,r=-1,i=n.length;while(++r<i)t+=f(n[r]);return t}},0),h=o.centroid=n({Feature:function(e){return h(e.geometry)},Polygon:function(e){var t=c(e.coordinates);return[t[0]/t[2],t[1]/t[2]]},MultiPolygon:function(e){var t=0,n=e.coordinates,r,i=0,s=0,o=0,u=-1,a=n.length;while(++u<a)r=c(n[u]),i+=r[0],s+=r[1],o+=r[2];return[i/o,s/o]}});return o.projection=function(e){return s=e,o},o.pointRadius=function(e){return typeof e=="function"?t=e:(t=+e,i=r(t)),o},o},e.geo.bounds=function(e){var t=Infinity,n=Infinity,r=-Infinity,s=-Infinity;return i(e,function(e,i){e<t&&(t=e),e>r&&(r=e),i<n&&(n=i),i>s&&(s=i)}),[[t,n],[r,s]]};var s={Feature:o,FeatureCollection:u,LineString:a,MultiLineString:f,MultiPoint:a,MultiPolygon:l,Point:c,Polygon:h};e.geo.circle=function(){function u(){}function a(e){return o.distance(e)<s}function l(e){var t=-1,n=e.length,r=[],i,u,a,f,l;while(++t<n)l=o.distance(a=e[t]),l<s?(u&&r.push(v(u,a)((f-s)/(f-l))),r.push(a),i=u=null):(u=a,!i&&r.length&&(r.push(v(r[r.length-1],u)((s-f)/(l-f))),i=u)),f=l;return u&&r.length&&(l=o.distance(a=r[0]),r.push(v(u,a)((f-s)/(f-l)))),c(r)}function c(e){var t=0,n=e.length,r,i,s=n?[e[0]]:e,u,a=o.source();while(++t<n){u=o.source(e[t-1])(e[t]).coordinates;for(r=0,i=u.length;++r<i;)s.push(u[r])}return o.source(a),s}var r=[0,0],i=89.99,s=i*t,o=e.geo.greatArc().target(Object);u.clip=function(e){return o.source(typeof r=="function"?r.apply(this,arguments):r),f(e)};var f=n({FeatureCollection:function(e){var t=e.features.map(f).filter(Object);return t&&(e=Object.create(e),e.features=t,e)},Feature:function(e){var t=f(e.geometry);return t&&(e=Object.create(e),e.geometry=t,e)},Point:function(e){return a(e.coordinates)&&e},MultiPoint:function(e){var t=e.coordinates.filter(a);return t.length&&{type:e.type,coordinates:t}},LineString:function(e){var t=l(e.coordinates);return t.length&&(e=Object.create(e),e.coordinates=t,e)},MultiLineString:function(e){var t=e.coordinates.map(l).filter(function(e){return e.length});return t.length&&(e=Object.create(e),e.coordinates=t,e)},Polygon:function(e){var t=e.coordinates.map(l);return t[0].length&&(e=Object.create(e),e.coordinates=t,e)},MultiPolygon:function(e){var t=e.coordinates.map(function(e){return e.map(l)}).filter(function(e){return e[0].length});return t.length&&(e=Object.create(e),e.coordinates=t,e)},GeometryCollection:function(e){var t=e.geometries.map(f).filter(Object);return t.length&&(e=Object.create(e),e.geometries=t,e)}});return u.origin=function(e){return arguments.length?(r=e,u):r},u.angle=function(e){return arguments.length?(s=(i=+e)*t,u):i},u.precision=function(e){return arguments.length?(o.precision(e),u):o.precision()},u},e.geo.greatArc=function(){function i(){var t=typeof e=="function"?e.apply(this,arguments):e,i=typeof n=="function"?n.apply(this,arguments):n,s=v(t,i),o=r/s.d,u=0,a=[t];while((u+=o)<1)a.push(s(u));return a.push(i),{type:"LineString",coordinates:a}}var e=p,n=d,r=6*t;return i.distance=function(){var t=typeof e=="function"?e.apply(this,arguments):e,r=typeof n=="function"?n.apply(this,arguments):n;return v(t,r).d},i.source=function(t){return arguments.length?(e=t,i):e},i.target=function(e){return arguments.length?(n=e,i):n},i.precision=function(e){return arguments.length?(r=e*t,i):r/t},i},e.geo.greatCircle=e.geo.circle}(t),t});